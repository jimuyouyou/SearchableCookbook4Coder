<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>json-string-serialize.html</title>
</head>
<body>
url: http://geekswithblogs.net/rgupta/archive/2014/06/25/combining-jquery-form-serialize-and-json.stringify-when-doing-ajax-post.aspx<p>

	<div class="postTitle"><a id="viewpost_ascx_TitleUrl" title="Title of this entry." href="http://geekswithblogs.net/rgupta/archive/2014/06/25/combining-jquery-form-serialize-and-json.stringify-when-doing-ajax-post.aspx">Combining jquery form serialize() and JSON.stringify() when doing ajax post in MVC</a></div>
<div class="postText">
<p>Most of the times we end up using either $(&lsquo;#myform&rsquo;).serialize() along with default contentType in ajax POST request, OR we use the JSON representation of the form using jquery helper methods, then call JSON.stringify(formData) and then set contentType = &ldquo;'application/json; charset=utf-8&rsquo;&rdquo; inorder to submit form data to the MVC Controller.</p>
<p>The JSON jquery helper is as shown below:</p>
<div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:9dd0cddf-da25-472f-b91c-24a9f6661c9e" class="wlWriterEditableSmartContent" style="float: none; margin: 0px; display: inline; padding: 0px;">
<div><span style="color: #008080;"> 1</span> <span style="color: #000000;">$.fn.serializeObject </span><span style="color: #000000;">=</span><span style="color: #000000;"> function () { </span><span style="color: #008080;"> 2</span> <span style="color: #000000;"> var o </span><span style="color: #000000;">=</span><span style="color: #000000;"> {}; </span><span style="color: #008080;"> 3</span> <span style="color: #000000;"> var a </span><span style="color: #000000;">=</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.serializeArray(); </span><span style="color: #008080;"> 4</span> <span style="color: #000000;"> $.each(a, function () { </span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">if</span><span style="color: #000000;"> (o[</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.name] </span><span style="color: #000000;">!==</span><span style="color: #000000;"> undefined) { </span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #000000;">!</span><span style="color: #000000;">o[</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.name].push) { </span><span style="color: #008080;"> 7</span> <span style="color: #000000;"> o[</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.name] </span><span style="color: #000000;">=</span><span style="color: #000000;"> [o[</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.name]]; </span><span style="color: #008080;"> 8</span> <span style="color: #000000;"> } </span><span style="color: #008080;"> 9</span> <span style="color: #000000;"> o[</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.name].push(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.value </span><span style="color: #000000;">||</span> <span style="color: #800000;">''</span><span style="color: #000000;">); </span><span style="color: #008080;">10</span> <span style="color: #000000;"> } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> { </span><span style="color: #008080;">11</span> <span style="color: #000000;"> o[</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.name] </span><span style="color: #000000;">=</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.value </span><span style="color: #000000;">||</span> <span style="color: #800000;">''</span><span style="color: #000000;">; </span><span style="color: #008080;">12</span> <span style="color: #000000;"> } </span><span style="color: #008080;">13</span> <span style="color: #000000;"> }); </span><span style="color: #008080;">14</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> o; </span><span style="color: #008080;">15</span> <span style="color: #000000;">};</span></div>
</div>
<p>Then we use the following to get the form Data in JSON form:</p>
<p>var formData = $(&lsquo;#myform&rsquo;).serializeObject();</p>
<p>Then to convert this JSON object to JSON string we use : data = JSON.stringify(formData);</p>
<p>============================================================</p>
<p>The added advantage of using $(&lsquo;#myform&rsquo;).serialize() along with default contentType in ajax POST request, is that if in the Controller Action method, we have a parameter for &ldquo;FormCollection formCollection&rdquo; then this parameter will be populated with the form data as well.</p>
<p>This is particularly helpful when we are using dynamically generated input fields in our HTML form.</p>
<p>============================================================</p>
<p>Similarly the added advantage of using JSON.stringify(formData) is that we can extend the formData (JSON object) with addititional data such as collections, Entities and so on as shown below:</p>
<div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:6eb128b1-fea8-4504-8e5b-251ba555ec5c" class="wlWriterEditableSmartContent" style="float: none; margin: 0px; display: inline; padding: 0px;">
<div><span style="color: #008080;">1</span> <span style="color: #000000;">var formData </span><span style="color: #000000;">=</span><span style="color: #000000;"> $(</span><span style="color: #800000;">'</span><span style="color: #800000;">#form</span><span style="color: #800000;">'</span><span style="color: #000000;">).serializeObject(); </span><span style="color: #008080;">2</span> <span style="color: #000000;">$.extend(formData, { Contacts : myContacts}); </span><span style="color: #008080;">3</span> <span style="color: #000000;">$.extend(formData, { Address : myAddress}); </span><span style="color: #008080;">4</span> <span style="color: #000000;">var result </span><span style="color: #000000;">=</span><span style="color: #000000;"> JSON.stringify(formData); </span><span style="color: #008080;">5</span></div>
</div>
<p>============================================================</p>
<p>&nbsp;</p>
<p>Now most of the times, we need both these advantages when submitting formData to Controller action method.</p>
<p>There is no straight forward way to accomplish this.</p>
<div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:c5aef179-825e-4886-9dfa-6631a98490a3" class="wlWriterEditableSmartContent" style="float: none; margin: 0px; display: inline; padding: 0px;">
<div><span style="color: #008080;"> 1</span> <span style="color: #800080;">1</span> <span style="color: #0000ff;">if</span><span style="color: #000000;"> you need to extend the data and send extension fields (</span><span style="color: #0000ff;">in</span><span style="color: #000000;"> formcollection) </span><span style="color: #000000;">-</span><span style="color: #000000;"> BOTH then we need to </span><span style="color: #0000ff;">do</span><span style="color: #000000;"> the following to convert the JSON </span><span style="color: #0000ff;">object</span><span style="color: #000000;"> to queryString. </span><span style="color: #008080;"> 2</span> <span style="color: #800080;">2</span> <span style="color: #008080;"> 3</span> <span style="color: #800080;">3</span><span style="color: #000000;"> var formData </span><span style="color: #000000;">=</span><span style="color: #000000;"> $(</span><span style="color: #800000;">'</span><span style="color: #800000;">#form</span><span style="color: #800000;">'</span><span style="color: #000000;">).serializeObject(); </span><span style="color: #008080;"> 4</span> <span style="color: #800080;">4</span><span style="color: #000000;"> $.extend(formData, { Address : myAddress}); </span><span style="color: #008080;"> 5</span> <span style="color: #800080;">5</span><span style="color: #000000;"> var result </span><span style="color: #000000;">=</span><span style="color: #000000;"> decodeURIComponent($.param(formData)); </span><span style="color: #008080;"> 6</span> <span style="color: #800080;">6</span> <span style="color: #008080;"> 7</span> <span style="color: #800080;">7</span><span style="color: #000000;"> Then use </span><span style="color: #008080;"> 8</span> <span style="color: #800080;">8</span><span style="color: #000000;"> $.ajax( </span><span style="color: #008080;"> 9</span> <span style="color: #800080;">9</span><span style="color: #000000;"> url: @Url.Action(</span><span style="color: #800000;">"</span><span style="color: #800000;">post url</span><span style="color: #800000;">"</span><span style="color: #000000;">) </span><span style="color: #008080;">10</span> <span style="color: #800080;">10</span><span style="color: #000000;"> data: decodeURIComponent($.param(formData)), </span><span style="color: #008080;">11</span> <span style="color: #800080;">11</span><span style="color: #000000;"> dataType: </span><span style="color: #800000;">'</span><span style="color: #800000;">json</span><span style="color: #800000;">'</span><span style="color: #000000;">, </span><span style="color: #008080;">12</span> <span style="color: #800080;">12</span><span style="color: #000000;"> type: </span><span style="color: #800000;">'</span><span style="color: #800000;">POST</span><span style="color: #800000;">'</span><span style="color: #000000;">, </span><span style="color: #008080;">13</span> <span style="color: #800080;">13</span><span style="color: #000000;"> success: function(){}, </span><span style="color: #008080;">14</span> <span style="color: #800080;">14</span><span style="color: #000000;"> ) </span><span style="color: #008080;">15</span> <span style="color: #800080;">15</span></div>
</div>
<p><br />However this works for extending the formData with simple Entities and fields, this does not work when we extend formData with Collections ( e.g. List of Contacts).</p>
<p>However this will work for simple formData extensions like {Address : myAddress}&nbsp;&nbsp;&nbsp; <br />If we need to pass (extend formData with ) collections then use the following solution:</p>
<div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:2141d0d0-d4c8-4f2f-9c87-3ac81b18e952" class="wlWriterEditableSmartContent" style="float: none; margin: 0px; display: inline; padding: 0px;">
<div><span style="color: #008080;">1</span> <span style="color: #000000;">create hidden field to the HTML Form: </span><span style="color: #008080;">2</span> <span style="color: #000000;">&lt;</span><span style="color: #000000;">input type</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">hidden</span><span style="color: #800000;">"</span><span style="color: #000000;"> id</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">formHiddenField</span><span style="color: #800000;">"</span><span style="color: #000000;"> name</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">formHiddenField</span><span style="color: #800000;">"</span> <span style="color: #000000;">/&gt;</span> <span style="color: #008080;">3</span></div>
</div>
<p>then use the following Javascript/Jquery code :</p>
<div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:4670fe4e-4cfd-4295-8015-04d11b0f4a8f" class="wlWriterEditableSmartContent" style="float: none; margin: 0px; display: inline; padding: 0px;">
<div><span style="color: #008080;"> 1</span> <span style="color: #000000;">var formData </span><span style="color: #000000;">=</span><span style="color: #000000;"> $(</span><span style="color: #800000;">'</span><span style="color: #800000;">#form</span><span style="color: #800000;">'</span><span style="color: #000000;">).serializeObject(); </span><span style="color: #008080;"> 2</span> <span style="color: #000000;">$.extend(formData, { Contacts : myContacts}); </span><span style="color: #008080;"> 3</span> <span style="color: #000000;">$.extend(formData, { Address : myAddress}); </span><span style="color: #008080;"> 4</span> <span style="color: #000000;">var result </span><span style="color: #000000;">=</span><span style="color: #000000;"> JSON.stringify(formData); </span><span style="color: #008080;"> 5</span> <span style="color: #008080;"> 6</span> <span style="color: #000000;">$(</span><span style="color: #800000;">'</span><span style="color: #800000;">#formHiddenField</span><span style="color: #800000;">'</span><span style="color: #000000;">).val(result); </span><span style="color: #008080;"> 7</span> <span style="color: #008080;"> 8</span> <span style="color: #000000;">then submit form </span><span style="color: #0000ff;">using</span><span style="color: #000000;">: </span><span style="color: #008080;"> 9</span> <span style="color: #000000;"> $.ajax( </span><span style="color: #008080;">10</span> <span style="color: #000000;"> url: @Url.Action(</span><span style="color: #800000;">"</span><span style="color: #800000;">post url</span><span style="color: #800000;">"</span><span style="color: #000000;">) </span><span style="color: #008080;">11</span> <span style="color: #000000;"> data: myForm.serialize(), </span><span style="color: #008080;">12</span> <span style="color: #000000;"> dataType: </span><span style="color: #800000;">'</span><span style="color: #800000;">json</span><span style="color: #800000;">'</span><span style="color: #000000;">, </span><span style="color: #008080;">13</span> <span style="color: #000000;"> type: </span><span style="color: #800000;">'</span><span style="color: #800000;">POST</span><span style="color: #800000;">'</span><span style="color: #000000;">, </span><span style="color: #008080;">14</span> <span style="color: #000000;"> success: function(){ </span><span style="color: #008080;">15</span> <span style="color: #000000;"> })</span></div>
</div>
<p>Then in the Controller Action method, use the following code:</p>
<div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:00c89cf6-b0f5-4c19-af34-56c5ba5ae772" class="wlWriterEditableSmartContent" style="float: none; margin: 0px; display: inline; padding: 0px;">
<div><span style="color: #008080;">1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">virtual</span><span style="color: #000000;"> ActionResult PostContacts(</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> formHiddenField, FormCollection collection, FacebookModel model){ </span><span style="color: #008080;">2</span> <span style="color: #008080;">3</span> <span style="color: #000000;">var parsed </span><span style="color: #000000;">=</span><span style="color: #000000;"> JsonConvert.DeserializeObject</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">FacebookModel</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(formHiddenField); </span><span style="color: #008080;">4</span> <span style="color: #000000;">then use the parsedModel </span><span style="color: #0000ff;">as</span><span style="color: #000000;"> usual. </span><span style="color: #008080;">5</span> <span style="color: #000000;">}</span></div>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>I found this very very useful when extending formData with JSON data collections and also using dynamic HTML fields and capturing them via FormCollection in the controller action methods.</p>
</div>
</body>
</html>